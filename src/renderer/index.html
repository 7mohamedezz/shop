<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self';" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>متجر السباكة</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="header-content">
      <h1>معرض احمد بدوي</h1>
      <nav role="navigation" aria-label="التنقل الرئيسي">
        <div class="nav-tabs">
          <button class="tab active" data-tab="create-invoice" aria-label="إنشاء فاتورة جديدة">
            <span>إنشاء فاتورة</span>
          </button>
          <button class="tab" data-tab="invoices" aria-label="عرض جميع الفواتير">
            <span>عرض الفواتير</span>
          </button>
          <button class="tab" data-tab="products" aria-label="إدارة المنتجات">
            <span>المنتجات</span>
          </button>
          <button class="tab" data-tab="low-stock" aria-label="المنتجات قرب النفاد">
            <span>قرب النفاد</span>
          </button>
          <button class="tab" data-tab="customers" aria-label="إدارة العملاء والسباكون">
            <span>العملاء</span>
          </button>
          <button class="tab" data-tab="search" aria-label="البحث في الفواتير">
            <span>بحث</span>
          </button>
          <button class="tab" data-tab="settings" aria-label="الإعدادات">
            <span>الإعدادات</span>
          </button>
        </div>
      </nav>
    </div>
  </header>

  <main>
    <section id="create-invoice" class="page active">
      <div class="panel">
        <h2>إنشاء فاتورة</h2>
        <form id="invoice-form">
          <div class="row">
            <label>اسم العميل
              <div class="autocomplete">
                <input type="text" id="cust-name" required/>
                <div id="cust-suggestions" class="suggestions" style="display:none"></div>
              </div>
            </label>
            <label>الهاتف<input type="text" id="cust-phone" required/></label>
            <label>السباك
              <div class="autocomplete">
                <input type="text" id="plumber-name" />
                <div id="plumber-suggestions" class="suggestions" style="display:none"></div>
              </div>
            </label>
          </div>
          <div class="row">
            <label>خصم ابوغالي %<input type="number" id="discount-abogali" min="0" max="100" step="1" value="0" /></label>
            <label>خصم BR %<input type="number" id="discount-br" min="0" max="100" step="1" value="0" /></label>
          </div>
          <div class="row">
            <label>ملاحظات<textarea id="invoice-notes" rows="2" placeholder="ملاحظات الفاتورة..."></textarea></label>
          </div>
          <div>
            <table class="items-table">
              <thead>
                <tr><th>الرقم</th><th>المنتج</th><th>الفئة</th><th>الكمية</th><th>سعر البيع</th><th>الإجمالي</th><th style="width:48px; text-align:center">تم التسليم</th><th></th></tr>
              </thead>
              <tbody id="items-body"></tbody>
            </table>
            <button type="button" id="add-item">+ إضافة بند</button>
          </div>
          <div class="row right">
            <div><strong>الإجمالي:</strong> <span id="total">0.00</span></div>
            <div><strong>المتبقي:</strong> <span id="remaining">0.00</span></div>
          </div>
          <div>
            <h3>المدفوعات</h3>
            <table class="items-table">
              <thead><tr><th>المبلغ</th><th>التاريخ</th><th>ملاحظة</th><th></th></tr></thead>
              <tbody id="payments-body"></tbody>
            </table>
            <button type="button" id="add-payment">+ إضافة دفعة</button>
          </div>
          <div class="row">
            <button type="submit">إنشاء فاتورة</button>
          </div>
          <div id="invoice-error" class="muted" style="color:#fca5a5"></div>
        </form>
      </div>
    </section>

    <section id="invoices" class="page">
      <div class="panel">
        <h2>قائمة الفواتير</h2>
        <div class="row">
          <input type="text" id="invoice-search" placeholder="بحث بالعميل أو السباك أو الهاتف" />
          <label style="display:flex; align-items:center; gap:6px">
            <input type="checkbox" id="show-deleted-only" /> عرض المحذوفة فقط
          </label>
          <button id="refresh-invoices">تحديث</button>
        </div>
        <div id="invoice-list"></div>
        <div id="invoice-detail" class="panel" style="margin-top:12px; display:none"></div>
      </div>
    </section>

    <section id="products" class="page">
      <div class="panel">
        <h2>المنتجات</h2>
        <div class="row">
          <input type="text" id="product-search" placeholder="بحث عن منتج بالاسم..." />
          <button id="product-search-btn">بحث</button>
          <button id="refresh-products">تحديث</button>
        </div>
        <form id="product-form" class="row">
          <input type="text" id="prod-name" placeholder="الاسم" required />
          <input type="text" id="prod-category" placeholder="الفئة (مثال: ابوغالي، BR)" />
          <input type="number" id="prod-buy" placeholder="سعر الشراء" step="0.01" required />
          <input type="number" id="prod-sell" placeholder="السعر" step="0.01" required />
          <input type="number" id="prod-stock" placeholder="المخزون" />
          <input type="number" id="prod-reorder" placeholder="حد إعادة الطلب" />
          <button type="submit">حفظ</button>
        </form>
        <div id="product-message" class="muted" style="margin:6px 0; color:#93c5fd"></div>
        <table class="items-table" id="product-table" style="margin-top:8px">
          <thead>
            <tr>
              <th>الاسم</th>
              <th>الفئة</th>
              <th>سعر الشراء</th>
              <th>السعر</th>
              <th>المخزون</th>
              <th>حد إعادة الطلب</th>
              <th style="width:160px">إجراءات</th>
            </tr>
          </thead>
          <tbody id="product-tbody"></tbody>
        </table>
      </div>
    </section>

    <section id="low-stock" class="page">
      <div class="panel">
        <h2>المنتجات قرب النفاد</h2>
        <div class="row">
          <button id="refresh-lowstock">تحديث</button>
        </div>
        <div id="lowstock-message" class="muted" style="margin:6px 0; color:#93c5fd"></div>
        <table class="items-table" id="lowstock-table" style="margin-top:8px">
          <thead>
            <tr>
              <th>الاسم</th>
              <th>الفئة</th>
              <th>سعر الشراء</th>
              <th>السعر</th>
              <th>المخزون</th>
              <th>حد إعادة الطلب</th>
              <th style="width:160px">إجراءات</th>
            </tr>
          </thead>
          <tbody id="lowstock-tbody"></tbody>
        </table>
      </div>
    </section>

    <section id="customers" class="page">
      <div class="panel">
        <h2>العملاء والسباكون</h2>
        <div class="row">
          <input type="text" id="live-customer-search" placeholder="ابحث عن عميل بالاسم أو الهاتف" />
          <div id="live-customer-results" class="suggestions" style="display:none; position:relative"></div>
          <input type="text" id="live-plumber-search" placeholder="ابحث عن سباك بالاسم أو الهاتف" />
          <div id="live-plumber-results" class="suggestions" style="display:none; position:relative"></div>
        </div>
        <h3>إضافة عميل</h3>
        <form id="customer-form" class="row">
          <input type="text" id="new-cust-name" placeholder="اسم العميل" required />
          <input type="text" id="new-cust-phone" placeholder="الهاتف" required />
          <button type="submit">حفظ</button>
        </form>
        <h3 style="margin-top:16px">إضافة سباك</h3>
        <form id="plumber-form" class="row">
          <input type="text" id="new-plumber-name" placeholder="اسم السباك" required />
          <input type="text" id="new-plumber-phone" placeholder="الهاتف" />
          <button type="submit">حفظ</button>
        </form>
        <div class="row" style="margin-top:12px">
          <button id="refresh-people">تحديث القوائم</button>
        </div>
        <div class="row" style="gap:24px; align-items:flex-start">
          <div style="flex:1">
            <h3>العملاء</h3>
            <div id="customer-list"></div>
          </div>
          <div style="flex:1">
            <h3>السباكون</h3>
            <div id="plumber-list"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="search" class="page">
      <div class="panel">
        <h2>بحث عام</h2>
        <div class="row">
          <input type="text" id="search-input" placeholder="اكتب للبحث عن الفواتير..." />
          <button id="search-btn">بحث</button>
          <button id="clear-search-btn">عرض الكل</button>
        </div>
        <div id="search-results"></div>
      </div>
    </section>

    <section id="settings" class="page">
      <div class="panel">
        <h2>الإعدادات</h2>
        
        <!-- Backup and Restore Section -->
        <div class="settings-section">
          <h3>النسخ الاحتياطية</h3>
          <div class="row">
            <button id="settings-backup-btn" class="btn-edit">نسخة احتياطية</button>
            <button id="settings-restore-btn" class="btn-print">استعادة نسخة</button>
          </div>
        </div>

        <!-- Font Size Section -->
        <div class="settings-section">
          <h3>حجم الخط</h3>
          <div class="row">
            <label for="settings-font-size">حجم الخط:</label>
            <input type="range" id="settings-font-size" min="12" max="24" value="16" />
            <span id="settings-font-size-value">16px</span>
          </div>
        </div>

        <!-- Default Discounts Section -->
        <div class="settings-section">
          <h3>الخصومات الافتراضية</h3>
          <div class="row">
            <label for="br-discount">خصم BR (%):</label>
            <input type="number" id="br-discount" min="0" max="100" step="0.1" value="0" />
          </div>
          <div class="row">
            <label for="aboghali-discount">خصم ابوغالي (%):</label>
            <input type="number" id="aboghali-discount" min="0" max="100" step="0.1" value="0" />
          </div>
          <div class="row">
            <button id="save-discounts-btn" class="btn-edit">حفظ الخصومات</button>
          </div>
        </div>
      </div>
    </section>
  </main>
  <!-- Simple modal for editing customer/plumber -->
  <div id="edit-person-modal" style="display:none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 1000; align-items: center; justify-content: center;">
    <div style="background: #fff; padding: 16px; border-radius: 8px; min-width: 320px; max-width: 90%; box-shadow: 0 10px 30px rgba(0,0,0,0.2);">
      <h3 id="edit-person-title" style="margin-top:0; margin-bottom:12px">تعديل</h3>
      <div class="row" style="display:flex; flex-direction:column; gap:8px; margin-bottom:12px">
        <input type="text" id="edit-person-name" placeholder="الاسم" />
        <input type="text" id="edit-person-phone" placeholder="الهاتف" />
        <div id="edit-person-error" class="muted" style="color:#ef4444"></div>
      </div>
      <div style="display:flex; gap:8px; justify-content:flex-end">
        <button id="edit-person-cancel">إلغاء</button>
        <button id="edit-person-save" style="background:#2563eb; color:#fff">حفظ</button>
      </div>
    </div>
  </div>

  <script src="renderer.js"></script>
  <script src="edit-invoice.js"></script>
</body>
</html>
